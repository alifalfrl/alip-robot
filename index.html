<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Alip AI - Chatbot AI Futuristik (v2025)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>

<style>
  /* Variabel CSS untuk Dark dan Light Mode */
  :root {
    /* Warna Dark Mode (Default) */
    --background-dark: #0A0A10; /* Hampir hitam */
    --surface-dark: #1A1A22; /* Permukaan elemen */
    --primary-neon-blue: #00F0FF; /* Biru neon cerah */
    --primary-neon-purple: #8A2BE2; /* Ungu neon cerah */
    --accent-neon-glow: rgba(0, 240, 255, 0.4); /* Efek glow biru */
    --accent-neon-glow-purple: rgba(138, 43, 226, 0.4); /* Efek glow ungu */
    --text-light: #E0E0E0; /* Teks terang */
    --text-medium: #A0A0A0; /* Teks sedang */
    --border-dark: #333340; /* Border gelap */
    --scroll-thumb: #555;
    --scroll-track: #222;
    --input-bg-dark: #282835;
    --input-focus-bg-dark: #303040;
    --user-bubble-bg: linear-gradient(45deg, #1A304F, #0A203F); /* Gradien biru gelap */
    --bot-bubble-bg: linear-gradient(45deg, #2E1A4F, #1E0A3F); /* Gradien ungu gelap */
    --error-bg-dark: #3A1515;
    --error-border-dark: #6B2020;
    --code-bg-dark: #1B1B25; /* Background kode gelap */
    --code-border-dark: #444;

    /* Warna Light Mode (Untuk toggle di masa depan) */
    --background-light: #F0F2F5; /* Abu-abu terang */
    --surface-light: #FFFFFF; /* Putih bersih */
    --primary-light-blue: #007BFF; /* Biru cerah */
    --primary-light-purple: #6A1B9A; /* Ungu cerah */
    --accent-light-shadow: rgba(0, 123, 255, 0.2);
    --text-dark: #333333; /* Teks gelap */
    --text-muted-light: #666666; /* Teks sedang */
    --border-light: #E0E0E0; /* Border terang */
    --scroll-thumb-light: #AAA;
    --scroll-track-light: #F0F0F0;
    --input-bg-light: #F8F8F8;
    --input-focus-bg-light: #FFFFFF;
    --user-bubble-bg-light: #E1F5FE; /* Biru muda */
    --bot-bubble-bg-light: #EDE7F6; /* Ungu muda */
    --error-bg-light: #FFE0E0;
    --error-border-light: #FF9999;
    --code-bg-light: #F5F5F5;
    --code-border-light: #DDD;


    /* Transisi Halus */
    --transition-speed: 0.3s;
    --transition-ease: cubic-bezier(0.25, 0.8, 0.25, 1);

    /* Variabel untuk margin dan tinggi yang dinamis */
    --form-height: 85px; /* Default height, akan diupdate oleh JS */
    --sidebar-width: 280px;
  }

  /* Tema Light Mode (akan diaktifkan dengan JS) */
  body.light-mode {
    --background-dark: var(--background-light);
    --surface-dark: var(--surface-light);
    --primary-neon-blue: var(--primary-light-blue);
    --primary-neon-purple: var(--primary-light-purple);
    --accent-neon-glow: var(--accent-light-shadow);
    --accent-neon-glow-purple: var(--accent-light-shadow);
    --text-light: var(--text-dark);
    --text-medium: var(--text-muted-light);
    --border-dark: var(--border-light);
    --scroll-thumb: var(--scroll-thumb-light);
    --scroll-track: var(--scroll-track-light);
    --input-bg-dark: var(--input-bg-light);
    --input-focus-bg-dark: var(--input-focus-bg-light);
    --user-bubble-bg: var(--user-bubble-bg-light);
    --bot-bubble-bg: var(--bot-bubble-bg-light);
    --error-bg-dark: var(--error-bg-light);
    --error-border-dark: var(--error-border-light);
    --code-bg-dark: var(--code-bg-light);
    --code-border-dark: var(--code-border-light);
  }

  /* Global Styles & Body */
  body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Poppins', 'DM Sans', sans-serif; /* Prioritas font modern */
    background: var(--background-dark);
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    position: relative; /* Untuk background animasi */
    overscroll-behavior: none; /* Mencegah pull-to-refresh di mobile */
    transition: background var(--transition-speed) var(--transition-ease), color var(--transition-speed) var(--transition-ease);
  }

  /* Animasi Background Gradient atau Partikel (simulasi) */
  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, var(--primary-neon-blue), var(--primary-neon-purple), var(--background-dark));
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    opacity: 0.2; /* Lebih halus */
    z-index: -1;
    transition: background var(--transition-speed) var(--transition-ease), opacity var(--transition-speed) var(--transition-ease);
  }

  body.light-mode::before {
      background: linear-gradient(45deg, var(--primary-light-blue), var(--primary-light-purple), var(--background-light));
      opacity: 0.1; /* Lebih halus di light mode */
  }


  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: var(--scroll-track);
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--scroll-thumb);
    border-radius: 4px;
    transition: background var(--transition-speed) var(--transition-ease);
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--primary-neon-blue);
    box-shadow: 0 0 5px var(--primary-neon-blue);
  }

  /* Header */
  header {
    background: var(--surface-dark);
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    z-index: 100;
    border-bottom: 1px solid var(--border-dark);
    flex-shrink: 0;
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  .logo {
    display: flex;
    align-items: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary-neon-blue);
    text-shadow: 0 0 10px var(--primary-neon-blue);
    letter-spacing: 1px;
    transition: color var(--transition-speed) var(--transition-ease), text-shadow var(--transition-speed) var(--transition-ease);
  }

  .logo i {
    font-size: 1.6rem;
    margin-right: 10px;
    color: var(--primary-neon-purple);
    text-shadow: 0 0 8px var(--primary-neon-purple);
    transition: color var(--transition-speed) var(--transition-ease), text-shadow var(--transition-speed) var(--transition-ease);
  }

  nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 1.5rem;
  }

  nav ul li a {
    color: var(--text-light);
    text-decoration: none;
    font-weight: 500;
    font-size: 1rem;
    position: relative;
    padding-bottom: 5px;
    transition: color var(--transition-speed) var(--transition-ease), text-shadow var(--transition-speed) var(--transition-ease);
  }

  nav ul li a::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 0;
    height: 2px;
    background: var(--primary-neon-blue);
    box-shadow: 0 0 8px var(--primary-neon-blue);
    transition: width var(--transition-speed) var(--transition-ease), background var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  nav ul li a:hover {
    color: var(--primary-neon-blue);
    text-shadow: 0 0 5px var(--primary-neon-blue);
  }

  nav ul li a:hover::after,
  nav ul li a.active::after {
    width: 100%;
  }

  /* Main Content Area */
  #main-content {
    flex: 1;
    display: flex;
    position: relative;
    overflow: hidden;
    padding: 20px;
    box-sizing: border-box;
  }

  /* Chat Container */
  #chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    overflow-y: auto;
    scroll-behavior: smooth;
    background: var(--surface-dark);
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    margin: 0 auto; /* Tengah */
    max-width: 900px; /* Batasi lebar */
    width: 100%; /* Agar responsif */
    border: 1px solid var(--border-dark);
    margin-bottom: calc(var(--form-height) + 20px); /* Ruang untuk form */
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease), margin-bottom var(--transition-speed) var(--transition-ease);
  }

  .message-wrapper {
    display: flex;
    margin-bottom: 1.5rem;
    align-items: flex-start;
    opacity: 0;
    transform: translateY(15px);
    animation: fadeIn 0.5s ease-out forwards;
  }

  .message-wrapper.user {
    justify-content: flex-end;
  }

  .message-wrapper.bot {
    justify-content: flex-start;
  }

  .avatar {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background-color: var(--primary-neon-purple);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 0 10px var(--primary-neon-purple);
    overflow: hidden;
    border: 2px solid var(--primary-neon-purple);
    transition: transform 0.2s ease-in-out, background-color var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  .avatar:hover {
    transform: scale(1.08);
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .message-wrapper.bot .avatar {
    margin-right: 15px;
  }

  .message-wrapper.user .avatar {
    order: 2;
    margin-left: 15px;
  }

  .message {
    max-width: 75%;
    padding: 1rem 1.6rem;
    border-radius: 25px;
    line-height: 1.6;
    /* white-space: pre-wrap; REMOVED FOR MARKDOWN RENDERING */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    word-wrap: break-word;
    font-size: 1.05rem;
    transition: all 0.3s var(--transition-ease);
    position: relative;
    overflow: hidden; /* Untuk efek neon border */
    color: var(--text-light); /* Sesuaikan warna teks berdasarkan tema */
  }

  .user .message {
    background: var(--user-bubble-bg);
    border-bottom-right-radius: 8px;
    border: 1px solid rgba(0, 240, 255, 0.3);
    box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  .bot .message {
    background: var(--bot-bubble-bg);
    border-bottom-left-radius: 8px;
    border: 1px solid rgba(138, 43, 226, 0.3);
    box-shadow: 0 0 15px rgba(138, 43, 226, 0.2);
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  /* Markdown & Code Styling */
  .message pre {
    background-color: var(--code-bg-dark);
    border: 1px solid var(--code-border-dark);
    border-radius: 8px;
    padding: 0.8rem 1rem;
    overflow-x: auto;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    position: relative;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    transition: background-color var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  .message pre code {
    font-family: 'Fira Code', 'JetBrains Mono', monospace; /* Font monospace untuk kode */
    font-size: 0.95rem;
    display: block; /* Agar highlight.js bisa bekerja */
    color: var(--text-light); /* Warna teks kode default */
  }

  .message p:first-child {
      margin-top: 0;
  }
  .message p:last-child {
      margin-bottom: 0;
  }

  .message ul, .message ol {
    margin-left: 1.5rem;
    padding-left: 0;
  }

  /* Input Form */
  form {
    display: flex;
    padding: 1.5rem 20px;
    background: var(--surface-dark);
    border-top: 1px solid var(--border-dark);
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.4);
    gap: 1rem;
    align-items: center;
    position: fixed; /* Menggunakan fixed agar selalu di bawah */
    bottom: 0;
    left: 0; /* Pastikan menempati seluruh lebar */
    width: 100%;
    box-sizing: border-box;
    z-index: 100;
    flex-shrink: 0;
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
  }

  input[type="text"] {
    flex: 1;
    padding: 1.2rem 1.8rem;
    font-size: 1.1rem;
    border-radius: 30px;
    border: 1px solid var(--border-dark);
    outline: none;
    background-color: var(--input-bg-dark); /* Sedikit lebih terang dari surface */
    color: var(--text-light);
    transition: border-color var(--transition-speed) var(--transition-ease),
                box-shadow var(--transition-speed) var(--transition-ease),
                background-color var(--transition-speed) var(--transition-ease),
                color var(--transition-speed) var(--transition-ease);
  }

  input[type="text"]::placeholder {
    color: var(--text-medium);
    transition: color var(--transition-speed) var(--transition-ease);
  }

  input[type="text"]:focus {
    border-color: var(--primary-neon-blue);
    box-shadow: 0 0 0 4px var(--accent-neon-glow), 0 0 15px var(--primary-neon-blue);
    background-color: var(--input-focus-bg-dark);
  }

  button[type="submit"] {
    background: linear-gradient(45deg, var(--primary-neon-blue), var(--primary-neon-purple));
    border: none;
    border-radius: 50%;
    color: white;
    font-weight: 600;
    font-size: 1.3rem;
    cursor: pointer;
    width: 55px;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s var(--transition-ease);
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    text-shadow: 0 0 8px rgba(255,255,255,0.7);
  }

  button[type="submit"]:hover:not(:disabled) {
    background: linear-gradient(45deg, var(--primary-neon-purple), var(--primary-neon-blue));
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(0,0,0,0.6), 0 0 20px var(--primary-neon-blue);
  }

  button[type="submit"]:active:not(:disabled) {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  button[type="submit"]:disabled {
    background: #444;
    cursor: not-allowed;
    opacity: 0.7;
    box-shadow: none;
    transform: none;
  }

  /* Error Message */
  #error {
    color: #FF6B6B;
    text-align: center;
    padding: 1rem;
    background-color: var(--error-bg-dark);
    border-radius: 10px;
    margin: 0 20px 20px 20px;
    font-size: 0.95rem;
    font-weight: 500;
    display: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    border: 1px solid var(--error-border-dark);
    flex-shrink: 0;
    transition: margin-bottom var(--transition-speed) var(--transition-ease), background-color var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease);
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Typing Animation (Changed to more sophisticated loader) */
  .typing-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px; /* Lebar lebih kecil */
    height: 40px; /* Tinggi lebih kecil */
    background: var(--bot-bubble-bg);
    border-radius: 20px; /* Radius lebih kecil */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
    position: relative;
    overflow: hidden;
  }

  .typing-indicator::before,
  .typing-indicator::after {
    content: '';
    position: absolute;
    width: 12px;
    height: 12px;
    background: var(--primary-neon-blue);
    border-radius: 50%;
    transform: scale(0);
    animation: bounce 1.2s infinite ease-in-out;
    box-shadow: 0 0 8px var(--primary-neon-blue);
  }

  .typing-indicator::before {
    left: 10px;
    animation-delay: 0s;
  }

  .typing-indicator::after {
    right: 10px;
    animation-delay: 0.3s;
  }

  /* Middle dot for animation */
  .typing-dot {
      width: 12px;
      height: 12px;
      background: var(--primary-neon-purple);
      border-radius: 50%;
      transform: scale(0);
      animation: bounce 1.2s infinite ease-in-out;
      animation-delay: 0.15s;
      box-shadow: 0 0 8px var(--primary-neon-purple);
  }


  @keyframes bounce {
    0%, 100% { transform: translateY(0) scale(0.8); opacity: 0.7; }
    50% { transform: translateY(-8px) scale(1.1); opacity: 1; }
  }


  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Sidebar / Floating Menu */
  .sidebar-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(45deg, var(--primary-neon-blue), var(--primary-neon-purple));
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
    transition: all 0.3s var(--transition-ease);
    z-index: 200; /* Lebih tinggi dari form dan chat */
    text-shadow: 0 0 5px rgba(255,255,255,0.7);
  }

  .sidebar-toggle:hover {
    background: linear-gradient(45deg, var(--primary-neon-purple), var(--primary-neon-blue));
    transform: rotate(90deg) scale(1.05);
    box-shadow: 0 8px 25px rgba(0,0,0,0.6), 0 0 20px var(--primary-neon-blue);
  }

  #sidebar {
    position: fixed;
    top: 0;
    right: calc(-1 * var(--sidebar-width)); /* Sembunyikan di luar layar */
    width: var(--sidebar-width);
    height: 100%;
    background: var(--surface-dark);
    box-shadow: -8px 0 30px rgba(0, 0, 0, 0.6);
    transition: right 0.4s var(--transition-ease), background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease);
    z-index: 199;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border-dark);
  }

  #sidebar.open {
    right: 0;
  }

  #sidebar h3 {
    font-family: 'DM Sans', sans-serif; /* Font yang lebih bersih untuk judul sidebar */
    color: var(--primary-neon-blue);
    text-align: center;
    margin-bottom: 30px;
    text-shadow: 0 0 10px var(--primary-neon-blue);
    transition: color var(--transition-speed) var(--transition-ease), text-shadow var(--transition-speed) var(--transition-ease);
  }

  .sidebar-options {
    flex-grow: 1; /* Ambil sisa ruang */
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .sidebar-options button, .sidebar-options-button button { /* Target both direct button and button inside a tag */
    width: 100%;
    padding: 1rem;
    background: var(--input-bg-dark);
    color: var(--text-light);
    border: 1px solid var(--border-dark);
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: background var(--transition-speed) var(--transition-ease),
                border-color var(--transition-speed) var(--transition-ease),
                color var(--transition-speed) var(--transition-ease),
                box-shadow var(--transition-speed) var(--transition-ease);
  }
  
  .sidebar-options-button { /* Style for anchor tag wrapper */
    text-decoration: none;
    display: block; /* Make the anchor tag take full width */
  }

  .sidebar-options button:hover, .sidebar-options-button button:hover {
    background: var(--primary-neon-blue);
    color: var(--background-dark); /* Teks menjadi gelap saat hover */
    border-color: var(--primary-neon-blue);
    box-shadow: 0 0 15px var(--accent-neon-glow);
  }

  .sidebar-options button i, .sidebar-options-button button i {
    font-size: 1.2rem;
  }

  /* Light/Dark Mode Toggle in Sidebar */
  .theme-toggle-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-dark);
    transition: border-color var(--transition-speed) var(--transition-ease);
  }

  .theme-toggle-wrapper span {
    font-size: 1rem;
    color: var(--text-medium);
    transition: color var(--transition-speed) var(--transition-ease);
  }

  .theme-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }

  .theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #333;
    transition: .4s;
    border-radius: 34px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: var(--primary-neon-blue);
    box-shadow: inset 0 0 5px var(--primary-neon-blue);
  }

  input:checked + .slider:before {
    transform: translateX(26px);
    background-color: var(--background-dark);
  }

  /* Footer */
  footer {
    background: var(--surface-dark);
    color: var(--text-medium);
    text-align: center;
    padding: 1rem 1.5rem;
    font-size: 0.9rem;
    border-top: 1px solid var(--border-dark);
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
    flex-shrink: 0;
    transition: background var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease), color var(--transition-speed) var(--transition-ease);
  }

  footer a {
    color: var(--primary-neon-blue);
    text-decoration: none;
    font-weight: 500;
    transition: color var(--transition-speed) var(--transition-ease), text-shadow var(--transition-speed) var(--transition-ease);
  }

  footer a:hover {
    color: var(--primary-neon-purple);
    text-shadow: 0 0 5px var(--primary-neon-purple);
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    header {
      flex-direction: column;
      align-items: flex-start;
      padding: 1rem;
    }
    .logo {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    nav ul {
      width: 100%;
      justify-content: space-around;
      gap: 0;
    }
    nav ul li a {
      font-size: 0.9rem;
    }
    #main-content {
      padding: 10px;
    }
    #chat-container {
      margin: 0 auto;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: calc(var(--form-height) + 10px); /* Gunakan --form-height */
    }
    #error {
      margin: 0 10px 10px 10px;
      padding: 0.8rem;
    }
    .message {
      max-width: 85%;
      padding: 0.8rem 1.2rem;
      font-size: 0.95rem;
    }
    .avatar {
      width: 36px;
      height: 36px;
      font-size: 0.9rem;
    }
    .message-wrapper.bot .avatar,
    .message-wrapper.user .avatar {
      margin-right: 10px;
      margin-left: 10px;
    }
    form {
      padding: 1rem 10px;
      gap: 0.5rem;
    }
    input[type="text"] {
      padding: 1rem 1.2rem;
      font-size: 1rem;
    }
    button[type="submit"] {
      width: 48px;
      height: 48px;
      font-size: 1.1rem;
    }
    .typing-indicator {
      width: 50px;
      height: 35px;
    }
    .typing-indicator::before,
    .typing-indicator::after,
    .typing-dot {
      width: 10px;
      height: 10px;
    }
    .sidebar-toggle {
      top: 10px;
      right: 10px;
      width: 45px;
      height: 45px;
      font-size: 1.3rem;
    }
    #sidebar {
      width: 250px;
      --sidebar-width: 250px; /* Update for smaller screens */
    }
  }

  @media (max-width: 480px) {
    .logo {
      font-size: 1.3rem;
    }
    nav ul {
      flex-wrap: wrap;
      justify-content: center;
    }
    nav ul li {
      margin-bottom: 5px;
    }
    form {
        padding: 0.8rem 10px; /* Sedikit lebih kecil di layar sangat kecil */
    }
    input[type="text"] {
        padding: 0.9rem 1rem;
        font-size: 0.9rem;
    }
    button[type="submit"] {
        width: 42px;
        height: 42px;
        font-size: 1rem;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo"><i class="fas fa-robot"></i> ALIP AI</div>
  <nav>
    <ul>
      <li><a href="#" class="active">Home</a></li>
      <li><a href="#">About</a></li>
      <li><a href="#">Contact</a></li>
    </ul>
  </nav>
</header>

<div id="main-content">
  <div id="chat-container"></div>
  <div id="error"></div>

  <button class="sidebar-toggle" id="sidebarToggle">
    <i class="fas fa-bars"></i>
  </button>

  <aside id="sidebar">
    <h3>Pengaturan AI</h3>
    <div class="theme-toggle-wrapper">
        <span>Dark Mode</span>
        <label class="theme-switch">
            <input type="checkbox" id="darkModeToggle" checked>
            <span class="slider round"></span>
        </label>
        <span>Light Mode</span> </div>
    <div class="sidebar-options">
      <button id="clearChatBtn"><i class="fas fa-redo"></i> Bersihkan Chat</button>
      <button id="downloadChatBtn"><i class="fas fa-download"></i> Unduh Chat</button>
      <a href="https://wa.me/6281249703469" target="_blank" class="sidebar-options-button">
        <button><i class="fab fa-whatsapp"></i> Laporkan Bug</button>
      </a>
    </div>
  </aside>
</div>

<form id="form">
  <input type="text" id="input" placeholder="Ketik pertanyaanmu..." autocomplete="off" required />
  <button type="submit" aria-label="Kirim pesan">
    <i class="fas fa-paper-plane"></i>
  </button>
</form>

<footer>
    <span>&copy; 2025 Alip AI. Dibuat dengan <i class="fas fa-heart" style="color: #e0245e;"></i> oleh <a href="https://wa.me/6281249703469" target="_blank">Ahmad Alif</a>.</span>
</footer>

<script>
  const chatContainer = document.getElementById('chat-container');
  const form = document.getElementById('form');
  const input = document.getElementById('input');
  const errorDiv = document.getElementById('error');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const sidebar = document.getElementById('sidebar');
  const clearChatBtn = document.getElementById('clearChatBtn');
  const downloadChatBtn = document.getElementById('downloadChatBtn');
  const darkModeToggle = document.getElementById('darkModeToggle');

  // URL Avatar Bot - Disarankan hosting gambar sendiri atau menggunakan CDN yang stabil
  const botAvatarUrl = 'https://img1.pixhost.to/images/6105/605212852_media.jpg'; 

  // Inisialisasi Marked.js untuk rendering Markdown
  // Ini penting agar Alip AI bisa memformat jawabannya dengan bold, italic, code block, dll.
  marked.setOptions({
    breaks: true, // Mengaktifkan line breaks seperti GitHub
    highlight: function(code, lang) {
      const language = hljs.getLanguage(lang) ? lang : 'plaintext';
      return hljs.highlight(code, { language }).value;
    }
  });

  // Array untuk menyimpan riwayat percakapan (untuk konteks)
  const conversationHistory = [];

  // Function to create and add a message to the chat
  function addMessage(text, sender) {
    const messageWrapper = document.createElement('div');
    messageWrapper.classList.add('message-wrapper', sender);

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');

    if (sender === 'bot') {
      const avatarImg = document.createElement('img');
      avatarImg.src = botAvatarUrl;
      avatarImg.alt = 'Alip AI Avatar';
      avatarImg.onerror = () => {
        avatar.textContent = 'AI';
        console.warn('Bot avatar image failed to load. Using text fallback.');
        avatarImg.remove();
      };
      avatar.appendChild(avatarImg);
    } else {
      avatar.textContent = 'YOU'; // Teks untuk avatar user
      avatar.style.backgroundColor = '#6A1B9A'; /* Warna ungu untuk user avatar */
      avatar.style.boxShadow = '0 0 10px #6A1B9A';
      avatar.style.borderColor = '#6A1B9A';
    }

    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    // Render Markdown ke HTML
    messageDiv.innerHTML = marked.parse(text); 

    if (sender === 'user') {
      messageWrapper.appendChild(messageDiv);
      messageWrapper.appendChild(avatar);
    } else {
      messageWrapper.appendChild(avatar);
      messageWrapper.appendChild(messageDiv);
    }

    chatContainer.appendChild(messageWrapper);
    scrollToBottom();
  }

  // Function to add typing animation
  function addTypingIndicator() {
    const messageWrapper = document.createElement('div');
    messageWrapper.classList.add('message-wrapper', 'bot');
    messageWrapper.id = 'typing-indicator-wrapper';

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');
    const avatarImg = document.createElement('img'); 
    avatarImg.src = botAvatarUrl;
    avatarImg.alt = 'Alip AI Avatar';
    avatarImg.onerror = () => { 
        avatar.textContent = 'AI'; 
        console.warn('Typing indicator avatar image failed to load. Using text fallback.');
        avatarImg.remove();
    };
    avatar.appendChild(avatarImg);

    const typingDiv = document.createElement('div');
    typingDiv.classList.add('typing-indicator');
    // Menggunakan satu div untuk animasi yang lebih kompleks (via CSS)
    const dot = document.createElement('span');
    dot.classList.add('typing-dot');
    typingDiv.appendChild(dot);


    messageWrapper.appendChild(avatar);
    messageWrapper.appendChild(typingDiv);
    chatContainer.appendChild(messageWrapper);
    scrollToBottom();
    return messageWrapper;
  }

  // Function to remove typing animation
  function removeTypingIndicator() {
    const typingElem = document.getElementById('typing-indicator-wrapper');
    if(typingElem) {
      typingElem.remove();
    }
  }

  // Function to simulate typing out the bot's response
  async function typeBotMessage(text) {
    const messageWrapper = document.createElement('div');
    messageWrapper.classList.add('message-wrapper', 'bot');

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');
    const avatarImg = document.createElement('img');
    avatarImg.src = botAvatarUrl;
    avatarImg.alt = 'Alip AI Avatar';
    avatarImg.onerror = () => { 
        avatar.textContent = 'AI'; 
        console.warn('Bot message avatar image failed to load. Using text fallback.');
        avatarImg.remove();
    };
    avatar.appendChild(avatarImg);

    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');

    messageWrapper.appendChild(avatar);
    messageWrapper.appendChild(messageDiv);
    chatContainer.appendChild(messageWrapper);
    
    // Pecah teks menjadi kata-kata untuk animasi yang lebih realistis
    const words = text.split(' ');
    let currentHtml = '';
    for (let i = 0; i < words.length; i++) {
      currentHtml += words[i] + (i < words.length - 1 ? ' ' : '');
      messageDiv.innerHTML = marked.parse(currentHtml); // Render Markdown secara bertahap
      scrollToBottom();
      await new Promise(resolve => setTimeout(resolve, 30)); // Kecepatan mengetik per kata
    }
    // Setelah selesai mengetik, pastikan seluruh konten dirender dengan Markdown
    // Ini juga akan menjalankan highlight.js
    messageDiv.innerHTML = marked.parse(text);
    hljs.highlightAll(); // Panggil highlight.js setelah konten ditambahkan
    scrollToBottom();
  }

  // Scroll otomatis ke bawah
  function scrollToBottom() {
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  // Fungsi untuk mengatur margin-bottom chat container dan error div
  function setDynamicMargins() {
    const formHeight = form.offsetHeight;
    document.documentElement.style.setProperty('--form-height', `${formHeight}px`);
    // Memastikan margin-bottom chat container dan error div diatur ulang
    chatContainer.style.marginBottom = `calc(var(--form-height) + 20px)`;
    if (errorDiv.style.display !== 'none') {
        errorDiv.style.marginBottom = `calc(var(--form-height) + 20px)`;
    }
  }

  // Panggil saat load dan setiap kali ukuran jendela/form berubah
  window.addEventListener('load', () => {
    setDynamicMargins();
    const welcomeMessage = "Halo! Gua Alip AI, asisten virtual futuristik yang siap bantu lu. Ada apa nih? Gua siap nemenin lu ngobrol, nanyain apa aja, atau sekadar curhat. Santai aja ya! \n\n*Coba tanyain apa aja ke gua ya!*";
    addMessage(welcomeMessage, 'bot');
    conversationHistory.push({ role: 'model', parts: welcomeMessage });
    hljs.highlightAll(); // Highlight welcome message if it contains code/markdown
  });

  // Panggil saat window di-resize
  window.addEventListener('resize', setDynamicMargins);

  // Observer untuk memantau perubahan ukuran pada form, jika kontennya dinamis
  const resizeObserverForm = new ResizeObserver(() => {
    setDynamicMargins();
  });
  resizeObserverForm.observe(form);

  // Fungsi utama untuk mengirim pesan ke API
  async function sendMessageToAPI(message) {
    const recentHistory = conversationHistory.slice(-10); // Ambil 10 pesan terakhir untuk konteks

    let fullPrompt = `Kamu adalah Alip AI, sebuah AI canggih dan futuristik. Gaya bahasamu santai, to the point, dan keren, mirip obrolan dengan teman. Gunakan bahasa 'lu' dan 'gua'. Jawaban harus singkat, jelas, dan interaktif. Jika ada pertanyaan tentang programming, berikan contoh kodenya dalam format Markdown (gunakan triple backticks \`\`\`language\ncode\n\`\`\`). Jika pertanyaan tidak masuk akal, berikan respons yang humoris tapi sopan.`;
    
    if (recentHistory.length > 0) {
        fullPrompt += `\n\nBerikut riwayat percakapan kita:\n`;
        recentHistory.forEach(msg => {
            fullPrompt += `${msg.role === 'user' ? 'Gua' : 'Alip AI'}: ${msg.parts}\n`;
        });
        fullPrompt += `\nBerdasarkan riwayat di atas, jawab pertanyaan gua ini:\n`;
    }
    fullPrompt += `Pertanyaan: ${message}`;

    const url = 'https://api.siputzx.my.id/api/ai/gemini-pro?content=' + encodeURIComponent(fullPrompt);

    try {
      errorDiv.style.display = 'none';
      const response = await fetch(url);
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(`HTTP error! Status: ${response.status} - ${errorData.message || response.statusText}`);
      }
      const data = await response.json();
      if(data.status === true && data.data) {
        return data.data;
      } else if(data.error) {
        errorDiv.textContent = `API Alip AI Error: ${data.error}`;
        errorDiv.style.display = 'block';
        return 'Waduh, Alip AI lagi error nih. Coba lagi bentar ya.';
      }
      return 'Gua gagal dapetin respon yang valid dari Alip AI. Coba lagi aja ya.';
    } catch (err) {
      errorDiv.textContent = `Ada masalah koneksi atau server: ${err.message}. Pastiin internet lu stabil atau coba lagi nanti.`;
      errorDiv.style.display = 'block';
      console.error("Error fetching from API:", err);
      return 'Duh, Alip AI gak bisa dihubungin nih. Coba lagi nanti ya, mungkin lagi ngopi.';
    }
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userText = input.value.trim();
    if (!userText) return;

    addMessage(userText, 'user');
    conversationHistory.push({ role: 'user', parts: userText });

    input.value = '';
    input.disabled = true;
    form.querySelector('button').disabled = true;

    const typingIndicator = addTypingIndicator();

    try {
      const reply = await sendMessageToAPI(userText);
      removeTypingIndicator();
      await typeBotMessage(reply);
      conversationHistory.push({ role: 'model', parts: reply });
    } catch (error) {
      removeTypingIndicator();
      // Error sudah ditangani di sendMessageToAPI
    } finally {
      input.disabled = false;
      form.querySelector('button').disabled = false;
      input.focus();
      scrollToBottom();
    }
  });

  // Sidebar Toggle
  sidebarToggle.addEventListener('click', () => {
    sidebar.classList.toggle('open');
    sidebarToggle.querySelector('i').classList.toggle('fa-bars');
    sidebarToggle.querySelector('i').classList.toggle('fa-times'); // Ganti ikon menjadi X
  });

  // Close sidebar when clicking outside (optional, but good UX)
  document.addEventListener('click', (e) => {
    if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
      sidebar.classList.remove('open');
      sidebarToggle.querySelector('i').classList.remove('fa-times');
      sidebarToggle.querySelector('i').classList.add('fa-bars');
    }
  });


  // Clear Chat Functionality
  clearChatBtn.addEventListener('click', () => {
    chatContainer.innerHTML = '';
    conversationHistory.length = 0; // Kosongkan riwayat
    errorDiv.style.display = 'none'; // Sembunyikan pesan error jika ada
    const welcomeMessage = "Halo! Gua Alip AI, asisten virtual futuristik yang siap bantu lu. Ada apa nih? Gua siap nemenin lu ngobrol, nanyain apa aja, atau sekadar curhat. Santai aja ya! \n\n*Coba tanyain apa aja ke gua ya!*";
    addMessage(welcomeMessage, 'bot');
    conversationHistory.push({ role: 'model', parts: welcomeMessage });
    sidebar.classList.remove('open'); // Tutup sidebar setelah aksi
    sidebarToggle.querySelector('i').classList.remove('fa-times');
    sidebarToggle.querySelector('i').classList.add('fa-bars');
  });

  // Download Chat Functionality
  downloadChatBtn.addEventListener('click', () => {
    let chatContent = '';
    const messages = chatContainer.querySelectorAll('.message-wrapper');
    messages.forEach(msgWrapper => {
      const sender = msgWrapper.classList.contains('user') ? 'Gua' : 'Alip AI'; // Menggunakan "Gua" dan "Alip AI" sesuai persona
      const messageText = msgWrapper.querySelector('.message').textContent; // Gunakan textContent untuk mendapatkan teks mentah
      chatContent += `${sender}: ${messageText}\n`;
    });

    const blob = new Blob([chatContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'alip_ai_chat_log.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    sidebar.classList.remove('open'); // Tutup sidebar setelah aksi
    sidebarToggle.querySelector('i').classList.remove('fa-times');
    sidebarToggle.querySelector('i').classList.add('fa-bars');
  });

  // Dark/Light Mode Toggle
  darkModeToggle.addEventListener('change', () => {
    document.body.classList.toggle('light-mode');
    // Simpan preferensi pengguna di localStorage
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    // Re-highlight code blocks after theme change if necessary
    // This is important because highlight.js styles might depend on parent theme classes
    hljs.highlightAll(); 
  });

  // Load theme preference from localStorage on page load
  window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        darkModeToggle.checked = false; // Pastikan toggle tidak dicentang jika light mode aktif
    } else {
        // Default ke dark mode jika tidak ada preferensi atau preferensi adalah dark
        document.body.classList.remove('light-mode');
        darkModeToggle.checked = true; // Pastikan toggle dicentang jika dark mode aktif
    }
    // Highlight all code blocks on page load
    hljs.highlightAll();
  });

</script>

</body>
</html>
