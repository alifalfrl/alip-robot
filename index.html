<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Alip AI - Asisten AI Cerdas</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  /* --- Variabel CSS & Manajemen Tema --- */
  :root {
    /* Warna Mode Gelap (Default) */
    --bg-primary: #17171C; /* Lebih gelap, modern */
    --surface-main: #202026; /* Panel utama */
    --surface-light: #2C2C35; /* Header, form */
    --text-primary: #E0E0E0;
    --text-secondary: #9CA3AF; /* Abu-abu terang */
    --accent-blue: #4F46E5; /* Biru keunguan yang lebih kalem */
    --accent-purple: #8B5CF6; /* Ungu yang lebih kalem */
    --border-color: #3F3F46; /* Border subtle */
    --input-bg: #3F3F46;
    --input-focus-border: #6B7280;
    --user-bubble-bg: #4F46E5; /* Langsung pakai accent-blue */
    --bot-bubble-bg: #374151; /* Abu-abu tua */
    --error-bg: #FECACA;
    --error-text: #DC2626;
    --button-bg: var(--accent-blue);
    --button-hover-bg: var(--accent-purple);
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-medium: rgba(0, 0, 0, 0.2);
    --shadow-strong: rgba(0, 0, 0, 0.4);

    /* Warna Mode Terang */
    --light-bg-primary: #F3F4F6;
    --light-surface-main: #FFFFFF;
    --light-surface-light: #E5E7EB;
    --light-text-primary: #1F2937;
    --light-text-secondary: #6B7280;
    --light-accent-blue: #1D4ED8;
    --light-accent-purple: #7C3AED;
    --light-border-color: #D1D5DB;
    --light-input-bg: #F9FAFB;
    --light-input-focus-border: #9CA3AF;
    --light-user-bubble-bg: #DBEAFE;
    --light-bot-bubble-bg: #E5E7EB;
    --light-error-bg: #FEE2E2;
    --light-error-text: #EF4444;
    --light-button-bg: var(--light-accent-blue);
    --light-button-hover-bg: var(--light-accent-purple);
    --light-shadow-light: rgba(0, 0, 0, 0.05);
    --light-shadow-medium: rgba(0, 0, 0, 0.1);
    --light-shadow-strong: rgba(0, 0, 0, 0.2);


    /* Transisi & Animasi */
    --transition-duration: 0.25s; /* Lebih cepat untuk kesan responsif */
    --transition-ease: ease-in-out;
  }

  /* Aktivasi Mode Terang */
  body.light-mode {
    --bg-primary: var(--light-bg-primary);
    --surface-main: var(--light-surface-main);
    --surface-light: var(--light-surface-light);
    --text-primary: var(--light-text-primary);
    --text-secondary: var(--light-text-secondary);
    --accent-blue: var(--light-accent-blue);
    --accent-purple: var(--light-accent-purple);
    --border-color: var(--light-border-color);
    --input-bg: var(--light-input-bg);
    --input-focus-border: var(--light-input-focus-border);
    --user-bubble-bg: var(--light-user-bubble-bg);
    --bot-bubble-bg: var(--light-bot-bubble-bg);
    --error-bg: var(--light-error-bg);
    --error-text: var(--light-error-text);
    --button-bg: var(--light-button-bg);
    --button-hover-bg: var(--light-button-hover-bg);
    --shadow-light: var(--light-shadow-light);
    --shadow-medium: var(--light-shadow-medium);
    --shadow-strong: var(--light-shadow-strong);
  }

  /* --- Global Styles & Body --- */
  * {
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    position: relative;
    overscroll-behavior: none;
    transition: background var(--transition-duration) var(--transition-ease), color var(--transition-duration) var(--transition-ease);
  }

  /* Scrollbar Kustom */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: var(--surface-main);
  }
  ::-webkit-scrollbar-thumb {
    background: var(--text-secondary);
    border-radius: 4px;
    transition: background var(--transition-duration);
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--accent-blue);
  }

  /* --- Header --- */
  header {
    background: var(--surface-light);
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px var(--shadow-medium);
    z-index: 100;
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
    transition: background var(--transition-duration) var(--transition-ease), border-color var(--transition-duration) var(--transition-ease), box-shadow var(--transition-duration) var(--transition-ease);
  }

  .logo {
    display: flex;
    align-items: center;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent-blue);
    letter-spacing: 0.5px;
    transition: color var(--transition-duration) var(--transition-ease);
  }

  .logo i {
    font-size: 1.3rem;
    margin-right: 8px;
    color: var(--accent-purple);
    transition: color var(--transition-duration) var(--transition-ease);
  }

  nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 1.5rem;
  }

  nav ul li a {
    color: var(--text-primary);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    position: relative;
    padding-bottom: 5px;
    transition: color var(--transition-duration) var(--transition-ease);
  }

  nav ul li a::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 0;
    height: 2px;
    background: var(--accent-blue);
    transition: width var(--transition-duration) var(--transition-ease);
  }

  nav ul li a:hover,
  nav ul li a.active {
    color: var(--accent-blue);
  }

  nav ul li a:hover::after,
  nav ul li a.active::after {
    width: 100%;
  }

  /* --- Area Konten Utama --- */
  #main-content {
    flex: 1;
    display: flex;
    position: relative;
    overflow: hidden;
    padding: 20px;
    box-sizing: border-box;
    justify-content: center;
  }

  /* Wadah Obrolan */
  #chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    overflow-y: auto;
    scroll-behavior: smooth;
    background: var(--surface-main);
    border-radius: 12px;
    box-shadow: 0 4px 20px var(--shadow-strong);
    max-width: 800px;
    width: 100%;
    border: 1px solid var(--border-color);
    margin-bottom: calc(var(--form-height, 80px) + 20px);
    transition: background var(--transition-duration) var(--transition-ease), border-color var(--transition-duration) var(--transition-ease), box-shadow var(--transition-duration) var(--transition-ease);
  }

  .message-wrapper {
    display: flex;
    margin-bottom: 1.2rem;
    align-items: flex-start;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.4s var(--transition-ease) forwards;
  }

  .message-wrapper.user {
    justify-content: flex-end;
  }

  .message-wrapper.bot {
    justify-content: flex-start;
  }

  .avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background-color: var(--accent-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
    overflow: hidden;
    transition: transform 0.2s var(--transition-ease), background-color var(--transition-duration) var(--transition-ease);
  }

  .avatar:hover {
    transform: scale(1.05);
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .message-wrapper.bot .avatar {
    margin-right: 12px;
  }

  .message-wrapper.user .avatar {
    order: 2;
    margin-left: 12px;
    background-color: var(--accent-purple);
  }

  .message {
    max-width: 75%;
    padding: 0.8rem 1.2rem;
    border-radius: 18px;
    line-height: 1.6;
    white-space: pre-wrap;
    box-shadow: 0 2px 10px var(--shadow-light);
    word-wrap: break-word;
    font-size: 0.95rem;
    transition: all 0.3s var(--transition-ease);
    color: var(--text-primary);
  }

  .message pre {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    padding: 0.6rem;
    margin: 0.5rem 0;
    overflow-x: auto;
    font-family: monospace;
    font-size: 0.85rem;
    line-height: 1.4;
  }

  .user .message {
    background: var(--user-bubble-bg);
    color: white; /* Kontras lebih baik untuk user bubble */
    border-bottom-right-radius: 6px;
  }

  .bot .message {
    background: var(--bot-bubble-bg);
    border-bottom-left-radius: 6px;
  }

  /* --- Formulir Input --- */
  form {
    display: flex;
    padding: 1.2rem 20px;
    background: var(--surface-light);
    border-top: 1px solid var(--border-color);
    box-shadow: 0 -4px 15px var(--shadow-medium);
    gap: 0.8rem;
    align-items: center;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    box-sizing: border-box;
    z-index: 100;
    flex-shrink: 0;
    transition: background var(--transition-duration) var(--transition-ease), border-color var(--transition-duration) var(--transition-ease), box-shadow var(--transition-duration) var(--transition-ease);
  }

  input[type="text"] {
    flex: 1;
    padding: 0.9rem 1.2rem;
    font-size: 1rem;
    border-radius: 25px;
    border: 1px solid var(--border-color);
    outline: none;
    background-color: var(--input-bg);
    color: var(--text-primary);
    transition: border-color var(--transition-duration) var(--transition-ease),
                box-shadow var(--transition-duration) var(--transition-ease),
                background-color var(--transition-duration) var(--transition-ease),
                color var(--transition-duration) var(--transition-ease);
  }

  input[type="text"]::placeholder {
    color: var(--text-secondary);
  }

  input[type="text"]:focus {
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3); /* Warna shadow lebih kalem */
    background-color: var(--surface-main); /* Mengubah background sedikit saat fokus */
  }

  button[type="submit"] {
    background: var(--button-bg);
    border: none;
    border-radius: 50%;
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s var(--transition-ease);
    box-shadow: 0 2px 8px var(--shadow-medium);
  }

  button[type="submit"]:hover:not(:disabled) {
    background: var(--button-hover-bg);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow-strong);
  }

  button[type="submit"]:active:not(:disabled) {
    transform: translateY(0);
    box-shadow: 0 1px 5px var(--shadow-light);
  }

  button[type="submit"]:disabled {
    background: #6B7280;
    cursor: not-allowed;
    opacity: 0.7;
    box-shadow: none;
    transform: none;
  }

  /* Tombol gulir ke bawah */
  #scrollToBottomBtn {
    position: absolute;
    bottom: calc(var(--form-height, 80px) + 30px);
    right: 50%;
    transform: translateX(50%);
    background: var(--button-bg);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 2px 10px var(--shadow-medium);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s var(--transition-ease);
    z-index: 99;
  }

  #scrollToBottomBtn.show {
    opacity: 1;
    visibility: visible;
    bottom: calc(var(--form-height, 80px) + 20px);
  }

  #scrollToBottomBtn:hover {
    background: var(--button-hover-bg);
    transform: translateX(50%) translateY(-2px) scale(1.03);
  }

  /* --- Pesan Error --- */
  #error {
    color: var(--error-text);
    background-color: var(--error-bg);
    border: 1px solid var(--error-text);
    text-align: center;
    padding: 0.8rem;
    border-radius: 8px;
    margin: 0 auto 15px auto;
    font-size: 0.9rem;
    font-weight: 500;
    display: none;
    box-shadow: 0 2px 8px var(--shadow-light);
    flex-shrink: 0;
    max-width: 800px;
    width: 100%;
    transition: margin-bottom var(--transition-duration) var(--transition-ease), background-color var(--transition-duration) var(--transition-ease);
  }

  /* --- Animasi Mengetik --- */
  .typing-indicator {
    display: flex;
    align-items: center;
    padding: 0.8rem 1.2rem;
    background: var(--bot-bubble-bg);
    border-radius: 18px;
    box-shadow: 0 2px 10px var(--shadow-light);
    max-width: fit-content;
    border-bottom-left-radius: 6px;
    transition: background var(--transition-duration) var(--transition-ease);
  }

  .typing-dot {
    width: 8px;
    height: 8px;
    margin: 0 3px;
    background-color: var(--text-secondary);
    border-radius: 50%;
    opacity: 0;
    animation: typing-fade 1.2s infinite ease-in-out;
    transition: background-color var(--transition-duration) var(--transition-ease);
  }

  .typing-dot:nth-child(1) { animation-delay: 0s; }
  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes typing-fade {
    0%, 80%, 100% { opacity: 0; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1); }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- Bagian Info (Tentang, Kontak) --- */
  .info-section {
    flex: 1;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: var(--surface-main);
    border-radius: 12px;
    box-shadow: 0 4px 20px var(--shadow-strong);
    max-width: 800px;
    width: 100%;
    padding: 2.5rem;
    border: 1px solid var(--border-color);
    transition: all var(--transition-duration) var(--transition-ease);
    animation: fadeIn 0.6s var(--transition-ease) forwards;
  }

  .info-section h2 {
    font-size: 2rem;
    color: var(--accent-blue);
    margin-bottom: 1rem;
    transition: color var(--transition-duration) var(--transition-ease);
  }

  .info-section p {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--text-primary);
    margin-bottom: 0.8rem;
    max-width: 600px;
  }

  .info-section ul {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
  }

  .info-section ul li {
    font-size: 1rem;
    color: var(--text-primary);
    margin-bottom: 0.6rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .info-section ul li i {
    color: var(--accent-purple);
    font-size: 1.1rem;
  }

  .info-section ul li a {
    color: var(--accent-blue);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .info-section ul li a:hover {
    color: var(--accent-purple);
  }

  .back-to-chat {
    background: var(--button-bg);
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    padding: 0.8rem 1.5rem;
    margin-top: 1.5rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s var(--transition-ease);
    box-shadow: 0 2px 10px var(--shadow-medium);
  }

  .back-to-chat:hover {
    background: var(--button-hover-bg);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow-strong);
  }

  /* --- Sidebar / Menu Mengambang --- */
  .sidebar-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: var(--button-bg);
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    cursor: pointer;
    box-shadow: 0 4px 15px var(--shadow-medium);
    transition: all 0.2s var(--transition-ease);
    z-index: 200;
  }

  .sidebar-toggle:hover {
    background: var(--button-hover-bg);
    transform: rotate(90deg) scale(1.05);
    box-shadow: 0 6px 20px var(--shadow-strong);
  }

  #sidebar {
    position: fixed;
    top: 0;
    right: -250px; /* Lebar default sidebar */
    width: 250px;
    height: 100%;
    background: var(--surface-light);
    box-shadow: -4px 0 20px var(--shadow-strong);
    transition: right 0.3s var(--transition-ease), background var(--transition-duration) var(--transition-ease), border-color var(--transition-duration) var(--transition-ease);
    z-index: 199;
    padding: 25px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border-color);
    align-items: center;
  }

  #sidebar.open {
    right: 0;
  }

  #sidebar h3 {
    color: var(--accent-blue);
    text-align: center;
    margin-bottom: 30px;
    transition: color var(--transition-duration) var(--transition-ease);
    font-size: 1.4rem;
  }

  .sidebar-options {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    max-width: 200px;
  }

  .sidebar-options button {
    width: 100%;
    padding: 0.9rem;
    background: var(--input-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.2s var(--transition-ease);
    box-shadow: 0 1px 5px var(--shadow-light);
  }

  .sidebar-options-button { /* Untuk link yang membungkus tombol */
    text-decoration: none;
    display: block;
    width: 100%;
  }

  .sidebar-options button:hover, .sidebar-options-button button:hover {
    background: var(--accent-blue);
    color: white;
    border-color: var(--accent-blue);
    box-shadow: 0 2px 8px var(--shadow-medium);
    transform: translateY(-1px);
  }

  .sidebar-options button i, .sidebar-options-button button i {
    font-size: 1.1rem;
  }

  /* Tambahan untuk tombol Copy */
  .message-actions {
    display: flex;
    gap: 8px;
    margin-top: 5px;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
  }

  .message-wrapper.bot:hover .message-actions,
  .message-wrapper.bot .message-actions.show {
    opacity: 1;
  }

  .message-actions button {
    background: rgba(0, 0, 0, 0.3); /* Transparan */
    color: white;
    border: none;
    border-radius: 5px;
    padding: 5px 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .message-actions button:hover {
    background: var(--accent-blue);
  }

  /* Toggle Mode Terang/Gelap di Sidebar */
  .theme-toggle-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
    transition: border-color var(--transition-duration) var(--transition-ease);
  }

  .theme-toggle-wrapper span {
    font-size: 0.9rem;
    color: var(--text-secondary);
    transition: color var(--transition-duration) var(--transition-ease);
  }

  .theme-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 28px;
  }

  .theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #6B7280; /* Abu-abu default */
    transition: .4s;
    border-radius: 28px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: var(--accent-blue);
  }

  input:checked + .slider:before {
    transform: translateX(22px);
    background-color: white;
  }

  /* Popup Bantuan */
  .help-modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease-out;
  }

  .help-modal-content {
    background-color: var(--surface-main);
    margin: auto;
    padding: 30px;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 5px 15px var(--shadow-strong);
    position: relative;
    transform: scale(0.95);
    opacity: 0;
    animation: scaleIn 0.3s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275);
    color: var(--text-primary);
  }

  .help-modal-content h2 {
    color: var(--accent-blue);
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.8rem;
    text-align: center;
  }

  .help-modal-content p {
    margin-bottom: 15px;
    line-height: 1.6;
  }

  .help-modal-content ul {
    list-style-type: disc;
    margin-left: 20px;
    margin-bottom: 20px;
  }

  .help-modal-content ul li {
    margin-bottom: 8px;
  }

  .close-button {
    color: var(--text-secondary);
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .close-button:hover,
  .close-button:focus {
    color: var(--accent-blue);
    text-decoration: none;
    cursor: pointer;
  }

  @keyframes scaleIn {
    from {
      transform: scale(0.95);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }


  /* --- Footer --- */
  footer {
    background: var(--surface-light);
    color: var(--text-secondary);
    text-align: center;
    padding: 0.8rem 1.5rem;
    font-size: 0.85rem;
    border-top: 1px solid var(--border-color);
    box-shadow: 0 -2px 8px var(--shadow-light);
    flex-shrink: 0;
    transition: background var(--transition-duration) var(--transition-ease), border-color var(--transition-duration) var(--transition-ease), color var(--transition-duration) var(--transition-ease);
  }

  footer a {
    color: var(--accent-blue);
    text-decoration: none;
    font-weight: 500;
    transition: color var(--transition-duration) var(--transition-ease);
  }

  footer a:hover {
    color: var(--accent-purple);
  }

  /* --- Penyesuaian Responsif --- */
  @media (max-width: 768px) {
    header {
      flex-direction: column;
      align-items: flex-start;
      padding: 0.8rem;
    }
    .logo {
      font-size: 1.3rem;
      margin-bottom: 8px;
    }
    .logo i {
        font-size: 1.1rem;
    }
    nav ul {
      width: 100%;
      justify-content: space-around;
      gap: 0;
    }
    nav ul li a {
      font-size: 0.85rem;
      padding-bottom: 3px;
    }
    #main-content {
      padding: 15px;
    }
    #chat-container, .info-section {
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: calc(var(--form-height, 80px) + 10px);
    }
    #error {
      margin: 0 auto 10px auto;
      padding: 0.7rem;
    }
    .message {
      max-width: 90%;
      padding: 0.7rem 1rem;
      font-size: 0.9rem;
      border-radius: 14px;
    }
    .avatar {
      width: 32px;
      height: 32px;
      font-size: 0.8rem;
    }
    .message-wrapper.bot .avatar,
    .message-wrapper.user .avatar {
      margin-right: 8px;
      margin-left: 8px;
    }
    form {
      padding: 1rem 15px;
      gap: 0.6rem;
    }
    input[type="text"] {
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
      border-radius: 20px;
    }
    button[type="submit"] {
      width: 42px;
      height: 42px;
      font-size: 1rem;
    }
    .typing-indicator {
      padding: 0.7rem 1rem;
    }
    .typing-dot {
      width: 7px;
      height: 7px;
      margin: 0 2px;
    }
    .sidebar-toggle {
      top: 15px;
      right: 15px;
      width: 45px;
      height: 45px;
      font-size: 1.2rem;
    }
    #sidebar {
      width: 220px;
      right: -220px;
      padding: 20px;
    }
    #sidebar h3 {
        font-size: 1.2rem;
        margin-bottom: 25px;
    }
    .sidebar-options button {
        padding: 0.8rem;
        font-size: 0.9rem;
    }
    .theme-toggle-wrapper {
        gap: 8px;
        margin-bottom: 15px;
    }
    .theme-toggle-wrapper span {
        font-size: 0.8rem;
    }
    .theme-switch {
        width: 45px;
        height: 25px;
    }
    .slider:before {
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
    }
    input:checked + .slider:before {
        transform: translateX(20px);
    }
    #scrollToBottomBtn {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
        bottom: calc(var(--form-height, 80px) + 25px);
    }
    #scrollToBottomBtn.show {
        bottom: calc(var(--form-height, 80px) + 15px);
    }
    .info-section h2 {
      font-size: 1.5rem;
    }
    .info-section p, .info-section ul li {
      font-size: 0.9rem;
    }
    .back-to-chat {
      padding: 0.7rem 1.2rem;
      font-size: 0.9rem;
    }
    footer {
        padding: 0.7rem;
        font-size: 0.75rem;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo" aria-label="Alip AI Logo"><i class="fas fa-robot"></i> ALIP AI</div>
  <nav aria-label="Navigasi Utama">
    <ul>
      <li><a href="#home-section" class="nav-link active" data-section="home">Beranda</a></li>
      <li><a href="#about-section" class="nav-link" data-section="about">Tentang</a></li>
      <li><a href="#contact-section" class="nav-link" data-section="contact">Kontak</a></li>
    </ul>
  </nav>
</header>

<div id="main-content">
  <div id="chat-container" aria-live="polite" aria-atomic="true"></div>
  <div id="error" role="alert" aria-hidden="true"></div>

  <button id="scrollToBottomBtn" title="Gulir ke Bawah" aria-label="Gulir ke pesan terbaru">
    <i class="fas fa-arrow-down"></i>
  </button>

  <button class="sidebar-toggle" id="sidebarToggle" aria-controls="sidebar" aria-expanded="false" title="Buka/Tutup Pengaturan">
    <i class="fas fa-bars"></i>
  </button>

  <aside id="sidebar" aria-label="Pengaturan dan Opsi">
    <h3>Pengaturan AI</h3>
    <div class="theme-toggle-wrapper">
        <span aria-hidden="true">Gelap</span>
        <label class="theme-switch" for="darkModeToggle">
            <input type="checkbox" id="darkModeToggle" checked aria-label="Tombol mode gelap">
            <span class="slider round"></span>
        </label>
        <span aria-hidden="true">Terang</span>
    </div>
    <div class="sidebar-options">
      <button id="clearChatBtn" aria-label="Bersihkan semua obrolan"><i class="fas fa-redo"></i> Bersihkan Chat</button>
      <button id="downloadChatBtn" aria-label="Unduh riwayat obrolan"><i class="fas fa-download"></i> Unduh Chat</button>
      <button id="helpBtn" aria-label="Buka bantuan penggunaan"><i class="fas fa-question-circle"></i> Buka Bantuan</button>
      <a href="https://wa.me/6281249703469" target="_blank" class="sidebar-options-button" rel="noopener noreferrer">
        <button aria-label="Laporkan bug via WhatsApp"><i class="fab fa-whatsapp"></i> Laporkan Bug</button>
      </a>
      <button id="newChatBtn" aria-label="Mulai obrolan baru"><i class="fas fa-plus"></i> Obrolan Baru</button>
    </div>
  </aside>

  <section id="about-section" class="info-section" aria-hidden="true">
    <h2>Tentang Alip AI</h2>
    <p>Alip AI adalah asisten virtual cerdas yang dirancang untuk membantu berbagai kebutuhan informasi Anda. Dengan teknologi AI terbaru, Alip AI siap menjawab pertanyaan, memberikan ide, dan menjadi teman ngobrol yang menyenangkan.</p>
    <p>Kami berdedikasi untuk terus meningkatkan kemampuan Alip AI agar selalu relevan dan bermanfaat bagi Anda.</p>
    <button class="back-to-chat" aria-label="Kembali ke obrolan"><i class="fas fa-comments"></i> Kembali ke Chat</button>
  </section>

  <section id="contact-section" class="info-section" aria-hidden="true">
    <h2>Kontak Kami</h2>
    <p>Ada pertanyaan atau ingin memberikan masukan? Jangan sungkan untuk menghubungi kami!</p>
    <ul>
      <li><i class="fas fa-envelope"></i> Email: <a href="mailto:support@alipai.com">support@alipai.com</a></li>
      <li><i class="fab fa-whatsapp"></i> WhatsApp: <a href="https://wa.me/6281249703469" target="_blank" rel="noopener noreferrer">+62 812-4970-3469</a></li>
      <li><i class="fas fa-globe"></i> Website: <a href="https://alipai.com" target="_blank" rel="noopener noreferrer">www.alipai.com</a> (Segera Hadir!)</li>
    </ul>
    <button class="back-to-chat" aria-label="Kembali ke obrolan"><i class="fas fa-comments"></i> Kembali ke Chat</button>
  </section>

</div>

<form id="chat-form">
  <input type="text" id="input" placeholder="Ketik pesanmu..." autocomplete="off" required aria-label="Area input pesan" />
  <button type="submit" aria-label="Kirim pesan">
    <i class="fas fa-paper-plane"></i>
  </button>
</form>

<footer>
    <span>&copy; <span id="currentYear"></span> Alip AI. Dibuat dengan <i class="fas fa-heart" style="color: #e0245e;"></i> oleh <a href="https://wa.me/6281249703469" target="_blank" rel="noopener noreferrer">Ahmad Alif</a>.</span>
</footer>

<div id="helpModal" class="help-modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
    <div class="help-modal-content">
        <span class="close-button" aria-label="Tutup bantuan">&times;</span>
        <h2 id="helpModalTitle"><i class="fas fa-info-circle"></i> Bantuan Alip AI</h2>
        <p>Selamat datang di Alip AI! Berikut adalah beberapa tips penggunaan:</p>
        <ul>
            <li>**Kirim Pesan:** Ketik pertanyaan atau perintah Anda di kolom input di bawah, lalu tekan tombol panah kirim atau Enter.</li>
            <li>**Bersihkan Chat:** Gunakan tombol "Bersihkan Chat" di sidebar untuk menghapus semua riwayat obrolan.</li>
            <li>**Ganti Tema:** Gunakan sakelar di sidebar untuk beralih antara mode gelap dan terang.</li>
            <li>**Salin Pesan:** Arahkan kursor ke pesan balasan dari Alip AI, dan tombol "Copy" akan muncul untuk menyalin teks.</li>
            <li>**Unduh Chat:** Klik tombol "Unduh Chat" untuk menyimpan riwayat obrolan Anda.</li>
            <li>**Navigasi:** Gunakan menu di header untuk beralih antara halaman "Beranda", "Tentang", dan "Kontak".</li>
        </ul>
        <p>Jika ada masalah, jangan ragu untuk melaporkannya!</p>
    </div>
</div>

<script>
  const chatContainer = document.getElementById('chat-container');
  const chatForm = document.getElementById('chat-form');
  const input = document.getElementById('input');
  const errorDiv = document.getElementById('error');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const sidebar = document.getElementById('sidebar');
  const clearChatBtn = document.getElementById('clearChatBtn');
  const downloadChatBtn = document.getElementById('downloadChatBtn');
  const darkModeToggle = document.getElementById('darkModeToggle');
  const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
  const navLinks = document.querySelectorAll('.nav-link');
  const infoSections = document.querySelectorAll('.info-section');
  const backToChatButtons = document.querySelectorAll('.back-to-chat');
  const newChatBtn = document.getElementById('newChatBtn');
  const helpBtn = document.getElementById('helpBtn');
  const helpModal = document.getElementById('helpModal');
  const closeModalBtn = helpModal.querySelector('.close-button');

  // URL Avatar Bot
  const botAvatarUrl = 'https://img1.pixhost.to/images/6105/605212852_media.jpg'; 

  let conversationHistory = [];
  let isTyping = false; // Flag untuk status mengetik AI

  /**
   * Menambahkan pesan ke container chat.
   * @param {string} text - Teks pesan.
   * @param {string} sender - Pengirim pesan ('user' atau 'bot').
   * @param {boolean} isTypingEffect - Apakah pesan ini akan diketik (hanya untuk bot).
   */
  function addMessage(text, sender, isTypingEffect = false) {
    const messageWrapper = document.createElement('div');
    messageWrapper.classList.add('message-wrapper', sender);

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');
    avatar.setAttribute('role', 'img');
    avatar.setAttribute('aria-label', sender === 'bot' ? 'Avatar Alip AI' : 'Avatar Anda');

    if (sender === 'bot') {
      const avatarImg = document.createElement('img');
      avatarImg.src = botAvatarUrl;
      avatarImg.alt = 'Avatar Alip AI';
      avatarImg.onerror = () => {
        avatar.textContent = 'AI';
        console.warn('Gambar avatar bot gagal dimuat. Menggunakan fallback teks.');
        avatarImg.remove();
      };
      avatar.appendChild(avatarImg);
    } else {
      avatar.textContent = 'Anda';
      avatar.style.backgroundColor = 'var(--accent-purple)';
    }

    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    // Jika tidak ada efek mengetik, langsung set innerHTML
    if (!isTypingEffect) {
      messageDiv.innerHTML = formatMessage(text);
    }

    if (sender === 'user') {
      messageWrapper.appendChild(messageDiv);
      messageWrapper.appendChild(avatar);
    } else {
      messageWrapper.appendChild(avatar);
      messageWrapper.appendChild(messageDiv);

      // Tambahkan tombol copy hanya untuk pesan bot
      const messageActions = document.createElement('div');
      messageActions.classList.add('message-actions');
      
      const copyButton = document.createElement('button');
      copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
      copyButton.title = 'Salin pesan';
      copyButton.addEventListener('click', () => copyToClipboard(text, copyButton));
      messageActions.appendChild(copyButton);

      messageWrapper.appendChild(messageActions);

      // Show actions on hover (CSS handles this, but ensures it's always there)
      messageWrapper.addEventListener('mouseenter', () => messageActions.classList.add('show'));
      messageWrapper.addEventListener('mouseleave', () => messageActions.classList.remove('show'));
    }

    chatContainer.appendChild(messageWrapper);
    scrollToBottom();

    // Return the messageDiv for typing effect if needed
    return messageDiv;
  }

  /**
   * Mengatur format pesan, termasuk blok kode Markdown.
   * @param {string} text - Teks mentah.
   * @returns {string} Teks yang sudah diformat HTML.
   */
  function formatMessage(text) {
    // Basic Markdown for code blocks
    text = text.replace(/```([\s\S]*?)```/g, (match, code) => {
        // Escape HTML entities within code block to prevent XSS
        const escapedCode = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        return `<pre><code>${escapedCode.trim()}</code></pre>`;
    });
    // Basic line breaks
    text = text.replace(/\n/g, '<br>');
    return text;
  }

  /**
   * Menambahkan indikator mengetik AI.
   * @returns {HTMLElement} Elemen pembungkus indikator mengetik.
   */
  function addTypingIndicator() {
    const messageWrapper = document.createElement('div');
    messageWrapper.classList.add('message-wrapper', 'bot');
    messageWrapper.id = 'typing-indicator-wrapper';
    messageWrapper.setAttribute('aria-label', 'Alip AI sedang mengetik');

    const avatar = document.createElement('div');
    avatar.classList.add('avatar');
    const avatarImg = document.createElement('img'); 
    avatarImg.src = botAvatarUrl;
    avatarImg.alt = 'Avatar Alip AI';
    avatarImg.onerror = () => { 
        avatar.textContent = 'AI'; 
        console.warn('Gambar avatar indikator mengetik gagal dimuat. Menggunakan fallback teks.');
        avatarImg.remove();
    };
    avatar.appendChild(avatarImg);

    const typingDiv = document.createElement('div');
    typingDiv.classList.add('typing-indicator');
    for(let i = 0; i < 3; i++) {
      const dot = document.createElement('span');
      dot.classList.add('typing-dot');
      typingDiv.appendChild(dot);
    }

    messageWrapper.appendChild(avatar);
    messageWrapper.appendChild(typingDiv);
    chatContainer.appendChild(messageWrapper);
    scrollToBottom();
    return messageWrapper;
  }

  /**
   * Menghapus indikator mengetik AI.
   */
  function removeTypingIndicator() {
    const typingElem = document.getElementById('typing-indicator-wrapper');
    if(typingElem) {
      typingElem.remove();
    }
  }

  /**
   * Menampilkan pesan bot dengan efek ketik.
   * @param {string} text - Teks yang akan diketik.
   */
  async function typeBotMessage(text) {
    const messageDiv = addMessage('', 'bot', true); // Add empty message div
    const formattedText = formatMessage(text); 
    const characters = formattedText.split('');
    let currentText = '';
    for (let i = 0; i < characters.length; i++) {
      currentText += characters[i];
      messageDiv.innerHTML = currentText;
      scrollToBottom();
      await new Promise(resolve => setTimeout(resolve, 15)); // Typing speed
    }
  }

  /**
   * Menggulir chat ke bagian bawah.
   */
  function scrollToBottom() {
    chatContainer.scrollTop = chatContainer.scrollHeight;
    scrollToBottomBtn.classList.remove('show');
  }

  /**
   * Menyesuaikan margin dinamis untuk formulir input.
   */
  function setDynamicMargins() {
    const formHeight = chatForm.offsetHeight;
    document.documentElement.style.setProperty('--form-height', `${formHeight}px`);
    chatContainer.style.marginBottom = `calc(var(--form-height) + 20px)`;
    if (errorDiv.style.display !== 'none') {
        errorDiv.style.marginBottom = `calc(var(--form-height) + 20px)`;
    }
  }

  /**
   * Menyalin teks ke clipboard.
   * @param {string} textToCopy - Teks yang akan disalin.
   * @param {HTMLElement} button - Tombol yang diklik (untuk feedback visual).
   */
  async function copyToClipboard(textToCopy, button) {
    try {
      await navigator.clipboard.writeText(textToCopy);
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-check"></i> Disalin!';
      button.classList.add('copied');
      setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('copied');
      }, 2000);
    } catch (err) {
      console.error('Gagal menyalin teks: ', err);
      alert('Gagal menyalin teks. Silakan salin manual.');
    }
  }

  // Event listener saat halaman dimuat
  window.addEventListener('load', () => {
    setDynamicMargins();
    const welcomeMessage = "Halo! Gua Alip AI, asisten virtual cerdas yang siap bantu lu. Ada apa nih? Gua siap nemenin lu ngobrol, nanyain apa aja, atau sekadar curhat. Santai aja ya!";
    addMessage(welcomeMessage, 'bot');
    conversationHistory.push({ role: 'model', parts: welcomeMessage });
    document.getElementById('currentYear').textContent = new Date().getFullYear();
  });

  // Event listener untuk resize window
  window.addEventListener('resize', setDynamicMargins);
  const resizeObserverForm = new ResizeObserver(setDynamicMargins);
  resizeObserverForm.observe(chatForm);

  // Event listener untuk scroll pada chat container
  chatContainer.addEventListener('scroll', () => {
    if (chatContainer.scrollHeight - chatContainer.scrollTop > chatContainer.clientHeight + 150) {
      scrollToBottomBtn.classList.add('show');
    } else {
      scrollToBottomBtn.classList.remove('show');
    }
  });

  // Event listener untuk tombol scroll ke bawah
  scrollToBottomBtn.addEventListener('click', scrollToBottom);

  /**
   * Mengirim pesan ke API AI dan mengembalikan respons.
   * @param {string} message - Pesan pengguna.
   * @returns {Promise<string>} Respon dari AI.
   */
  async function sendMessageToAPI(message) {
    const recentHistory = conversationHistory.slice(-10); // Ambil 10 pesan terakhir

    let fullPrompt = `Kamu adalah Alip AI, sebuah AI canggih dan futuristik. Gaya bahasamu santai, to the point, dan keren, mirip obrolan dengan teman. Gunakan bahasa 'lu' dan 'gua'. Jawaban harus singkat, jelas, dan interaktif. Jika ada pertanyaan tentang programming, berikan contoh kodenya (formatnya tidak perlu terlalu panjang, cukup yang penting saja). Jika pertanyaan tidak masuk akal, berikan respons yang humoris tapi sopan.`;

    if (recentHistory.length > 0) {
        fullPrompt += `\n\nBerikut riwayat percakapan kita:\n`;
        recentHistory.forEach(msg => {
            fullPrompt += `${msg.role === 'user' ? 'Gua' : 'Alip AI'}: ${msg.parts}\n`;
        });
        fullPrompt += `\nBerdasarkan riwayat di atas, jawab pertanyaan gua ini:\n`;
    }
    fullPrompt += `Pertanyaan: ${message}`;

    const url = 'https://api.siputzx.my.id/api/ai/gemini-pro?content=' + encodeURIComponent(fullPrompt);

    try {
      errorDiv.style.display = 'none';
      const response = await fetch(url);
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(`HTTP error! Status: ${response.status} - ${errorData.message || response.statusText}`);
      }
      const data = await response.json();
      if(data.status === true && data.data) {
        return data.data;
      } else if(data.error) {
        errorDiv.textContent = `API Alip AI Error: ${data.error}`;
        errorDiv.style.display = 'block';
        return 'Waduh, Alip AI lagi error nih. Coba lagi bentar ya.';
      }
      return 'Gua gagal dapetin respon yang valid dari Alip AI. Coba lagi aja ya.';
    } catch (err) {
      errorDiv.textContent = `Ada masalah koneksi atau server: ${err.message}. Pastiin internet lu stabil atau coba lagi nanti.`;
      errorDiv.style.display = 'block';
      console.error("Error fetching from API:", err);
      return 'Duh, Alip AI gak bisa dihubungin nih. Coba lagi nanti ya, mungkin lagi ngopi.';
    }
  }

  // Event listener untuk submit formulir chat
  chatForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userText = input.value.trim();
    if (!userText || isTyping) return; // Jangan kirim jika kosong atau AI sedang mengetik

    addMessage(userText, 'user');
    conversationHistory.push({ role: 'user', parts: userText });

    input.value = '';
    input.disabled = true;
    chatForm.querySelector('button').disabled = true;
    isTyping = true;

    const typingIndicator = addTypingIndicator();

    try {
      const reply = await sendMessageToAPI(userText);
      removeTypingIndicator();
      await typeBotMessage(reply); // Gunakan fungsi typeBotMessage
      conversationHistory.push({ role: 'model', parts: reply });
    } catch (error) {
      removeTypingIndicator();
    } finally {
      input.disabled = false;
      chatForm.querySelector('button').disabled = false;
      input.focus();
      scrollToBottom();
      isTyping = false;
    }
  });

  // Event listener untuk tombol sidebar toggle
  sidebarToggle.addEventListener('click', () => {
    const isOpen = sidebar.classList.toggle('open');
    sidebarToggle.querySelector('i').classList.toggle('fa-times', isOpen);
    sidebarToggle.querySelector('i').classList.toggle('fa-bars', !isOpen);
    sidebarToggle.setAttribute('aria-expanded', isOpen);
  });

  // Event listener untuk menutup sidebar jika klik di luar
  document.addEventListener('click', (e) => {
    if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
      sidebar.classList.remove('open');
      sidebarToggle.querySelector('i').classList.remove('fa-times');
      sidebarToggle.querySelector('i').classList.add('fa-bars');
      sidebarToggle.setAttribute('aria-expanded', false);
    }
  });

  // Event listener untuk tombol Bersihkan Chat
  clearChatBtn.addEventListener('click', () => {
    if (confirm('Yakin mau bersihin semua riwayat obrolan? Aksi ini gak bisa dibatalin lho!')) {
      chatContainer.innerHTML = '';
      conversationHistory = [];
      errorDiv.style.display = 'none';
      const welcomeMessage = "Halo! Gua Alip AI, asisten virtual cerdas yang siap bantu lu. Ada apa nih? Gua siap nemenin lu ngobrol, nanyain apa aja, atau sekadar curhat. Santai aja ya!";
      addMessage(welcomeMessage, 'bot');
      conversationHistory.push({ role: 'model', parts: welcomeMessage });
      sidebar.classList.remove('open');
      sidebarToggle.querySelector('i').classList.remove('fa-times');
      sidebarToggle.querySelector('i').classList.add('fa-bars');
      sidebarToggle.setAttribute('aria-expanded', false);
      hideInfoSections();
      showChat(); // Pastikan kembali ke tampilan chat
    }
  });

  // Event listener untuk tombol Obrolan Baru (sama seperti bersihkan chat)
  newChatBtn.addEventListener('click', () => {
    clearChatBtn.click(); // Trigger the clear chat confirmation
  });

  // Event listener untuk tombol Unduh Chat
  downloadChatBtn.addEventListener('click', () => {
    let chatContent = 'Riwayat Obrolan Alip AI\n\n';
    const messages = chatContainer.querySelectorAll('.message-wrapper');
    messages.forEach(msgWrapper => {
      if (msgWrapper.id === 'typing-indicator-wrapper') return; 

      const sender = msgWrapper.classList.contains('user') ? 'Anda' : 'Alip AI';
      // Ambil teks dari innerHTML pesan, lalu hapus tag HTML (khususnya <br> dan <pre><code>)
      const messageElement = msgWrapper.querySelector('.message');
      let messageText = messageElement.textContent; // Mengambil textContent untuk membersihkan HTML

      // Handle preformatted code blocks specifically
      const preElements = messageElement.querySelectorAll('pre code');
      preElements.forEach(pre => {
          // Replace the `<code>` with its text content, preserving original newlines for pre
          const originalCodeBlock = `\`\`\`${pre.textContent.trim()}\`\`\``;
          messageText = messageText.replace(pre.textContent, originalCodeBlock);
      });
      
      chatContent += `${sender}: ${messageText}\n\n`;
    });

    const blob = new Blob([chatContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `alip_ai_chat_log_${new Date().toISOString().slice(0,10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    sidebar.classList.remove('open');
    sidebarToggle.querySelector('i').classList.remove('fa-times');
    sidebarToggle.querySelector('i').classList.add('fa-bars');
    sidebarToggle.setAttribute('aria-expanded', false);
  });

  // Event listener untuk tombol Ganti Tema
  darkModeToggle.addEventListener('change', () => {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
  });

  // Memuat tema saat halaman dimuat
  window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        darkModeToggle.checked = false; // Checkbox should be unchecked for light mode
    } else {
        document.body.classList.remove('light-mode');
        darkModeToggle.checked = true; // Checkbox should be checked for dark mode
    }
  });

  /**
   * Menampilkan bagian informasi (Tentang, Kontak).
   * @param {string} sectionId - ID bagian yang akan ditampilkan.
   */
  function showSection(sectionId) {
    infoSections.forEach(section => {
      section.classList.remove('active-section');
      section.setAttribute('aria-hidden', true);
      section.style.display = 'none';
    });
    chatContainer.style.display = 'none';
    chatForm.style.display = 'none';
    errorDiv.style.display = 'none';
    scrollToBottomBtn.style.display = 'none';

    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
      targetSection.style.display = 'flex';
      targetSection.classList.add('active-section');
      targetSection.setAttribute('aria-hidden', false);
    }
    sidebar.classList.remove('open');
    sidebarToggle.querySelector('i').classList.remove('fa-times');
    sidebarToggle.querySelector('i').classList.add('fa-bars');
    sidebarToggle.setAttribute('aria-expanded', false);
  }

  /**
   * Menampilkan kembali bagian chat utama.
   */
  function showChat() {
    infoSections.forEach(section => {
      section.classList.remove('active-section');
      section.setAttribute('aria-hidden', true);
      section.style.display = 'none';
    });
    chatContainer.style.display = 'flex';
    chatForm.style.display = 'flex';
    // Hanya tampilkan errorDiv jika ada konten error
    errorDiv.style.display = errorDiv.textContent ? 'block' : 'none'; 
    scrollToBottomBtn.style.display = 'flex';
    scrollToBottom();
  }

  /**
   * Menyembunyikan semua bagian informasi.
   */
  function hideInfoSections() {
    infoSections.forEach(section => {
      section.classList.remove('active-section');
      section.setAttribute('aria-hidden', true);
      section.style.display = 'none';
    });
  }

  // Event listeners untuk link navigasi di header
  navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      navLinks.forEach(nav => nav.classList.remove('active'));
      e.target.classList.add('active');
      const sectionId = e.target.dataset.section;
      if (sectionId === 'home') {
        showChat();
      } else {
        showSection(sectionId);
      }
    });
  });

  // Event listeners untuk tombol "Kembali ke Chat"
  backToChatButtons.forEach(button => {
    button.addEventListener('click', () => {
      showChat();
      navLinks.forEach(nav => nav.classList.remove('active'));
      document.querySelector('.nav-link[data-section="home"]').classList.add('active');
    });
  });

  // Inisialisasi tampilan chat saat halaman dimuat (setelah welcome message)
  window.addEventListener('load', () => {
    showChat();
    navLinks.forEach(nav => nav.classList.remove('active'));
    document.querySelector('.nav-link[data-section="home"]').classList.add('active');
  });

  // Help Modal Functionality
  helpBtn.addEventListener('click', () => {
    helpModal.style.display = 'flex';
    helpModal.setAttribute('aria-hidden', 'false');
    sidebar.classList.remove('open'); // Close sidebar when modal opens
    sidebarToggle.querySelector('i').classList.remove('fa-times');
    sidebarToggle.querySelector('i').classList.add('fa-bars');
    sidebarToggle.setAttribute('aria-expanded', false);
  });

  closeModalBtn.addEventListener('click', () => {
    helpModal.style.display = 'none';
    helpModal.setAttribute('aria-hidden', 'true');
  });

  window.addEventListener('click', (event) => {
    if (event.target == helpModal) {
      helpModal.style.display = 'none';
      helpModal.setAttribute('aria-hidden', 'true');
    }
  });

  // Close modal with Escape key
  window.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && helpModal.style.display === 'flex') {
      helpModal.style.display = 'none';
      helpModal.setAttribute('aria-hidden', 'true');
    }
  });

</script>

</body>
</html>
